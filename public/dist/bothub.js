!function(e){function t(s){if(n[s])return n[s].exports;var r=n[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,s){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:s})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,n){"use strict";function s(e,t,n){if(n=n||!0,!e)return"";var r="";if(/string|number|boolean/.test(void 0===e?"undefined":h(e)))return r+="&"+t+"="+(n?encodeURIComponent(e):e);for(var i in e){var o=t?t+"["+i+"]":i;r+=s(e[i],o,n)}return r}function r(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(t);return null!=n?decodeURI(n[2]):null}function i(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+1e3+4e3+8e3+1e11).replace(/[018]/g,i)}function o(e){return JSON.parse(JSON.stringify(e))}function c(){if(BOTHUB.debug)for(var e in arguments)console.log(arguments[e])}function a(e,t){var n=document.createElement("script"),s="jsonp_callback_bh"+Math.round(1e5*Math.random());window[s]=function(e){document.body.removeChild(n),t&&t(e)},n.src=e+(e.indexOf("?")>=0?"&":"?")+"callback="+s,document.body.appendChild(n)}function u(e,t,n){var s=new XMLHttpRequest;return s.open(e,t),"POST"===e&&s.setRequestHeader("Content-Type","application/json"),s.send("GET"===e?null:JSON.stringify(n)),s}function p(){var e=r("custom_user_id")||localStorage.getItem("bothub_custom_user_id")||"";return e||(e=i(),localStorage.setItem("bothub_custom_user_id",e),e)}function d(e){var t=r(e)||localStorage.getItem(e)||"";return t&&localStorage.setItem(e,t),t}function _(){return"bh_eid_"+i()}function g(e){e=e||!1;var t=localStorage.getItem("bothub_user_ref");return!e&&t||(t=location.host.replace(/\./g,"_")+"_"+i(),localStorage.setItem("bothub_user_ref",t)),t}function f(e){var t=e.replace("fb","bothub"),n=window[t];return n?(n.setAttribute("class",e),n):document.getElementsByClassName(e)[0]}function l(e){if(!window["facebook-jssdk"]){-1===["zh_CN","zh_TW","en_US"].indexOf(e.language)&&(e.language="zh_CN"),c("start load facebook sdk...");var t=document.createElement("script");t.id="facebook-jssdk",t.src="https://connect.facebook.net/"+e.language+"/"+(e.debug?"sdk/debug":"sdk")+".js",document.body.appendChild(t)}}t.__esModule=!0;var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b=arguments;t.urlEncode=s,t.getUrlParam=r,t.uuid=i,t.copy=o,t.log=c,t.jsonp=a,t.getCustomUserId=p,t.getFacebookUserId=d,t.getEventId=_,t.getUserRef=g,t.getPlugin=f,t.loadFacebookSdk=l,Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),n=1;n<b.length;n++){var s=b[n];if(void 0!==s&&null!==s){s=Object(s);for(var r=Object.keys(Object(s)),i=0,o=r.length;i<o;i++){var c=r[i],a=Object.getOwnPropertyDescriptor(s,c);void 0!==a&&a.enumerable&&(t[c]=s[c])}}}return t}});t.Http={get:function(e,t){return u("GET",e,t)},post:function(e,t){return u("POST",e,t)}}},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function initFacebook(bothub){var prev=window.fbAsyncInit;window.fbAsyncInit=function(){(0,_utils.log)("facebook sdk loaded."),FB.init({appId:bothub.Messenger.messenger_app_id,xfbml:!0,version:"v2.6"}),FB.Event.subscribe("messenger_checkbox",bothub.Plugin.checkboxListener),FB.Event.subscribe("send_to_messenger",bothub.Plugin.sendToMessengerListener),window.bhAsyncInit&&window.bhAsyncInit(),"function"==typeof prev&&(eval("window.oldCb = "+prev.toString().replace("xfbml","fbml")),window.oldCb())},window.FB&&window.fbAsyncInit(),(0,_utils.loadFacebookSdk)(bothub)}var _botHub=__webpack_require__(2),_botHub2=_interopRequireDefault(_botHub),_utils=__webpack_require__(0);BOTHUB._isins||(window.BOTHUB=new _botHub2.default(BOTHUB),initFacebook(window.BOTHUB))},function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(3),o=s(i),c=n(4),a=s(c),u=n(5),p=s(u),d=n(0);e.exports=function e(t){r(this,e);var n=t.fb_user_id_key||"fb_user_id",s=(0,d.getFacebookUserId)(n);this.debug=t.debug||!1,this._isins=!0,this.page_id=t.facebook_page_id,this.custom_user_id=(0,d.getCustomUserId)(),this.fb_user_id=s,this.api_server=t.api_server||"https://t.bothub.ai/",this.platforms=t.platforms||["facebook","bothub"],this.entrance=t.entrance||{},this.ecommerce=t.ecommerce||{},this.language=t.language||"zh_CN",this.Messenger={origin:location.protocol+"//"+location.host,page_id:t.facebook_page_id,messenger_app_id:t.messenger_app_id||"985673201550272",user_ref:(0,d.getUserRef)(),fb_user_id:s,allow_login:!0},this.ECommerce=new a.default(this),this.Marketing=new o.default(this),this.Plugin=new p.default(this),this.Plugin.initMessengerCheckbox(),this.Plugin.initSendToMessenger(),this.Plugin.initMessageUs(),this.Plugin.initCustomerChat()}},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=n(0);e.exports=function(){function e(t){s(this,e),this.parent=t}return e.prototype.logEvent=function(e,t,n){if(e){t||(t=null),n instanceof Object||(n={});var s=this.parent.Messenger,i={id:(0,r.getEventId)(),ev:e,params:(0,r.copy)(n)};if(this.parent.entrance.fb_messenger_checkbox_ref&&(i=Object.assign(i,this.parent.entrance.fb_messenger_checkbox_ref)),i.custom_user_id=this.parent.custom_user_id,this.parent.fb_user_id&&(n.fb_user_id=this.parent.fb_user_id,i.fb_user_id=this.parent.fb_user_id),i.user_id||i.fb_user_id||i.custom_user_id){n.user_ref=(0,r.getUserRef)(),n.ref=JSON.stringify(i);var o={app_id:s.messenger_app_id,page_id:s.page_id,user_ref:n.user_ref,ref:n.ref};if(this.parent.platforms.indexOf("facebook")>=0){var c=(0,r.copy)(n);delete c.user_ref,delete c.ref,"fb_mobile_purchase"===e?FB.AppEvents.logPurchase(t,n[FB.AppEvents.ParameterNames.CURRENCY],c):(FB.AppEvents.logEvent("MessengerCheckboxUserConfirmation",null,o),FB.AppEvents.logEvent(e,t,c),(0,r.log)("FB.AppEvents.logEvent",{eventName:e,valueToSum:t,analyticsParams:c}))}else if(this.parent.platforms.indexOf("bothub")>=0){delete o.user_ref,window.query={cd:o};var a=(0,r.urlEncode)({cd:o});(0,r.jsonp)(this.parent.api_server+"analytics/events?action=store"+a)}}}},e.prototype.logAddedToCartEvent=function(e,t,n,s){var r={},i=FB.AppEvents.ParameterNames;r[i.CONTENT_ID]=e,r[i.CONTENT_TYPE]=t,r[i.CURRENCY]=n,this.logEvent(FB.AppEvents.EventNames.ADDED_TO_CART,s,r)},e.prototype.logAddedToWishlistEvent=function(e,t,n,s){var r={},i=FB.AppEvents.ParameterNames;r[i.CONTENT_ID]=e,r[i.CONTENT_TYPE]=t,r[i.CURRENCY]=n,this.logEvent(FB.AppEvents.EventNames.ADDED_TO_WISHLIST,s,r)},e.prototype.logInitiatedCheckoutEvent=function(e,t,n,s,r,i){var o={},c=FB.AppEvents.ParameterNames;o[c.CONTENT_ID]=e,o[c.CONTENT_TYPE]=t,o[c.NUM_ITEMS]=n,o[c.PAYMENT_INFO_AVAILABLE]=s?1:0,o[c.CURRENCY]=r,this.logEvent(FB.AppEvents.EventNames.INITIATED_CHECKOUT,i,o)},e.prototype.logPurchaseEvent=function(e,t,n){var s={},r=FB.AppEvents.ParameterNames;s[r.CONTENT_ID]=e,s[r.CURRENCY]=t,this.logEvent("fb_mobile_purchase",n,s)},e}()},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=n(0);e.exports=function(){function e(t){s(this,e),this.parent=t,this.ecommerce=this.parent.ecommerce,this.plugin={messenger_checkbox:{receipt:"",receipt_id:"",sent:!1},send_to_messenger:{receipt:"",receipt_id:"",feed:"",feed_id:"",sent:!1}},Object.assign(this.plugin.messenger_checkbox,this.ecommerce.messenger_checkbox),Object.assign(this.plugin.send_to_messenger,this.ecommerce.send_to_messenger)}return e.prototype.getReceiptId=function(e){return this.plugin[e].receipt_id?this.plugin[e].receipt_id:(this.plugin[e].receipt_id=(0,r.uuid)(),this.plugin[e].receipt_id)},e.prototype.getFeedId=function(e){return this.plugin[e].feed_id?this.plugin[e].feed_id:(this.plugin[e].feed_id=(0,r.uuid)(),this.plugin[e].feed_id)},e.prototype.sendToMessenger=function(e){var t=this.plugin[e],n=this.parent.page_id;if(!t.sent)return t.receipt?(t.receipt={ev:"bh_receipt",receipt_id:t.receipt_id,page_id:n,data:t.receipt},r.Http.post(this.parent.api_server+"tr/",t.receipt),void(t.sent=!0)):void(t.feed&&(t.feed={ev:"bh_feed",feed_id:t.feed_id,page_id:n,data:t.feed},r.Http.post(this.parent.api_server+"tr/",t.feed),t.sent=!0))},e.prototype.resetMessengerCheckboxReceipt=function(e){var t=(0,r.getPlugin)("fb-messenger-checkbox");t&&(t.removeAttribute("fb-iframe-plugin-query"),this.plugin.messenger_checkbox.receipt=e,this.plugin.messenger_checkbox.receipt_id="",BOTHUB.Plugin.initMessengerCheckbox(),window.FB.XFBML.parse(),this.plugin.messenger_checkbox.sent=!1)},e.prototype.resetSendToMessengerReceipt=function(e){var t="bh_receipt"===e.ev?"receipt":"feed",n=(0,r.getPlugin)("fb-send-to-messenger");n&&(n.removeAttribute("fb-iframe-plugin-query"),this.plugin.send_to_messenger[t]=e,this.plugin.send_to_messenger[t+"_id"]="",BOTHUB.Plugin.initSendToMessenger(),window.FB.XFBML.parse(),this.plugin.send_to_messenger.sent=!1)},e.prototype.resetSendToMessengerFeed=function(e){this.plugin.send_to_messenger.receipt="",this.plugin.send_to_messenger.receipt_id="",this.resetSendToMessengerReceipt(e)},e}()},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=n(0);e.exports=function(){function e(t){s(this,e),this.parent=t,this.messenger_checkbox=(0,r.getPlugin)("fb-messenger-checkbox"),this.send_to_messenger=(0,r.getPlugin)("fb-send-to-messenger"),this.messageus=(0,r.getPlugin)("fb-messengermessageus"),this.customerchat=(0,r.getPlugin)("fb-customerchat")}return e.prototype.checkboxListener=function(e){if((0,r.log)("messenger_checkbox event:",e),"rendered"===e.event)(0,r.log)("Messenger plugin was rendered"),BOTHUB.ECommerce.sendToMessenger("messenger_checkbox");else if("checkbox"===e.event){var t=e.state;(0,r.log)("Checkbox state: "+t)}else"not_you"===e.event?(0,r.log)("User clicked not you"):"hidden"===e.event&&(0,r.log)("Messenger plugin was hidden")},e.prototype.sendToMessengerListener=function(e){(0,r.log)("send_to_messenger event:",e),"rendered"===e.event?((0,r.log)("Send to messenger plugin was rendered"),BOTHUB.ECommerce.sendToMessenger("send_to_messenger")):"clicked"===e.event?(0,r.log)("User clicked send to messenger"):"not_you"===e.event?(0,r.log)("User clicked not you"):"hidden"===e.event&&(0,r.log)("Send to messenger plugin was hidden")},e.prototype.initMessengerCheckbox=function(){if(this.messenger_checkbox){this.parent.entrance.fb_messenger_checkbox_ref=this.parent.entrance.fb_messenger_checkbox_ref||{},this.parent.ECommerce.plugin.messenger_checkbox.receipt&&Object.assign(this.parent.entrance.fb_messenger_checkbox_ref,{receipt_id:this.parent.ECommerce.getReceiptId("messenger_checkbox")}),this.parent.Messenger.user_ref=(0,r.getUserRef)(!0);for(var e in this.parent.Messenger)this.messenger_checkbox.setAttribute(e,this.parent.Messenger[e])}else this.parent.Messenger.user_ref=(0,r.getUserRef)()},e.prototype.initSendToMessenger=function(){if(this.send_to_messenger){this.send_to_messenger.setAttribute("messenger_app_id",this.parent.Messenger.messenger_app_id),this.send_to_messenger.setAttribute("page_id",this.parent.Messenger.page_id);var e=this.parent.entrance.fb_send_to_messenger_data_ref||{};e.length&&(e=JSON.parse(atob(e.replace("base64:",""))),delete e.receipt_id,delete e.feed_id),this.parent.ECommerce.plugin.send_to_messenger.receipt&&(e.receipt_id=this.parent.ECommerce.getReceiptId("send_to_messenger")),!e.receipt_id&&this.parent.ECommerce.plugin.send_to_messenger.feed&&(e.feed_id=this.parent.ECommerce.getFeedId("send_to_messenger")),e="base64:"+btoa(JSON.stringify(e)),"base64:e30="!==e&&this.send_to_messenger.setAttribute("data-ref",e)}},e.prototype.initMessageUs=function(){this.messageus&&(this.messageus.setAttribute("messenger_app_id",this.parent.Messenger.messenger_app_id),this.messageus.setAttribute("page_id",this.parent.Messenger.page_id))},e.prototype.initCustomerChat=function(){this.customerchat&&(this.customerchat.setAttribute("page_id",this.parent.Messenger.page_id),this.parent.entrance.fb_customerchat_ref&&this.customerchat.setAttribute("ref",this.parent.entrance.fb_customerchat_ref))},e}()}]);
!function(e){function t(s){if(n[s])return n[s].exports;var r=n[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,s){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:s})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,n){"use strict";function s(){return"Microsoft Internet Explorer"===navigator.appName&&parseInt(navigator.appVersion.split(";")[1].replace(/[ ]/g,"").replace("MSIE",""))<9}function r(e,t,n){if(n=n||!0,!e)return"";var s="";if(/string|number|boolean/.test(void 0===e?"undefined":v(e)))return s+="&"+t+"="+(n?encodeURIComponent(e):e);for(var i in e){var o=t?t+"["+i+"]":i;s+=r(e[i],o,n)}return s}function i(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(t);return null!=n?decodeURI(n[2]):null}function o(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+1e3+4e3+8e3+1e11).replace(/[018]/g,o)}function a(e){return JSON.parse(JSON.stringify(e))}function c(e){return e instanceof Object&&e.hasOwnProperty("cookies")&&e.cookies instanceof Array}function u(e){return e.name&&(e.value||""===e.value)&&/(string|number)/.test(v(e.name))&&/(string|number)/.test(v(e.value))&&(e.attributes instanceof Object||!e.attributes)}function _(){if(BOTHUB.debug)for(var e in arguments)console.log(arguments[e])}function d(e,t){var n=document.createElement("script"),s="jsonp_callback_bh"+Math.round(1e5*Math.random());window[s]=function(e){if(document.body.removeChild(n),c(e)){var s=e.cookies;for(var r in s)u(s[r])&&E.set("__bothub_"+s[r].name,s[r].value,s[r].attributes)}t&&t(e)},n.src=e+(e.indexOf("?")>=0?"&":"?")+"callback="+s,document.body.appendChild(n)}function p(e,t,n){var s=new XMLHttpRequest;return s.open(e,t),"POST"===e&&s.setRequestHeader("Content-Type","application/json"),s.send("GET"===e?null:JSON.stringify(n)),s}function f(){var e=i("custom_user_id")||E.get("bothub_custom_user_id")||"";return e||(e=o(),E.set("bothub_custom_user_id",e,{expires:365,path:"/"}),e)}function g(e){var t="__"+e,n=i(e)||E.get(t)||"";return n&&E.set(t,n,{expires:1,path:"/"}),n}function l(){return"bh_eid_"+o()}function m(e){e=e||!1;var t=E.get("__bothub_user_ref");return!e&&t||(t=location.host.replace(/\./g,"_")+"_"+o(),E.set("__bothub_user_ref",t,{expires:1,path:"/"})),t}function h(e){if(-1===["zh_CN","zh_TW","en_US"].indexOf(e.language)&&(e.language="zh_CN"),window["facebook-jssdk"])_("duplicate load facebook-jssdk, see https://github.com/bothub-ai/bothub-sdk-for-javascript");else{_("start load facebook sdk...");var t=document.createElement("script");t.id="facebook-jssdk",t.src=e.debug?"https://connect.facebook.net/"+e.language+"/sdk/debug.js":"https://connect.facebook.net/"+e.language+"/sdk.js",document.body.appendChild(t)}}function b(e){return document.getElementsByClassName(e)[0]}t.__esModule=!0;var v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.isOldIE=s,t.urlEncode=r,t.getUrlParam=i,t.uuid=o,t.copy=a,t.log=_,t.jsonp=d,t.getCustomUserId=f,t.getFacebookUserId=g,t.getEventId=l,t.getUserRef=m,t.loadFacebookSdk=h,t.getPlugin=b;var E=n(4);t.Http={get:function(e,t){return p("GET",e,t)},post:function(e,t){return p("POST",e,t)}},t.EventNames={ACHIEVED_LEVEL:"fb_mobile_level_achieved",ADDED_PAYMENT_INFO:"fb_mobile_add_payment_info",ADDED_TO_CART:"fb_mobile_add_to_cart",ADDED_TO_WISHLIST:"fb_mobile_add_to_wishlist",COMPLETED_REGISTRATION:"fb_mobile_complete_registration",COMPLETED_TUTORIAL:"fb_mobile_tutorial_completion",INITIATED_CHECKOUT:"fb_mobile_initiated_checkout",PAGE_VIEW:"fb_page_view",RATED:"fb_mobile_rate",SEARCHED:"fb_mobile_search",SPENT_CREDITS:"fb_mobile_spent_credits",UNLOCKED_ACHIEVEMENT:"fb_mobile_achievement_unlocked",VIEWED_CONTENT:"fb_mobile_content_view"},t.ParameterNames={APP_USER_ID:"_app_user_id",APP_VERSION:"_appVersion",CURRENCY:"fb_currency",REGISTRATION_METHOD:"fb_registration_method",CONTENT_TYPE:"fb_content_type",CONTENT_ID:"fb_content_id",SEARCH_STRING:"fb_search_string",SUCCESS:"fb_success",MAX_RATING_VALUE:"fb_max_rating_value",PAYMENT_INFO_AVAILABLE:"fb_payment_info_available",NUM_ITEMS:"fb_num_items",LEVEL:"fb_level",DESCRIPTION:"fb_description"}},function(e,t,n){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=n(2),i=function(e){return e&&e.__esModule?e:{default:e}}(r),o=n(0);if("object"===("undefined"==typeof BOTHUB?"undefined":s(BOTHUB))&&!BOTHUB._isins)if((0,o.isOldIE)()){var a=function(){};BOTHUB.Marketing={logAddedToCartEvent:a,logAddedToWishlistEvent:a,logInitiatedCheckoutEvent:a,logEvent:a}}else window.BOTHUB=new i.default(BOTHUB),function(e){window.fbAsyncInit=function(){(0,o.log)("facebook sdk loaded."),FB.init({appId:e.Messenger.messenger_app_id,xfbml:!0,version:"v2.6"}),FB.Event.subscribe("messenger_checkbox",function(t){if((0,o.log)("messenger_checkbox event:",t),"rendered"===t.event)(0,o.log)("Messenger plugin was rendered"),e.ECommerce.sendToMessenger("messenger_checkbox");else if("checkbox"===t.event){var n=t.state;(0,o.log)("Checkbox state: "+n)}else"not_you"===t.event?(0,o.log)("User clicked not you"):"hidden"===t.event&&(0,o.log)("Messenger plugin was hidden")}),FB.Event.subscribe("send_to_messenger",function(t){(0,o.log)("send_to_messenger event:",t),"rendered"===t.event?((0,o.log)("Send to messenger plugin was rendered"),e.ECommerce.sendToMessenger("send_to_messenger")):"clicked"===t.event?(0,o.log)("User clicked send to messenger"):"not_you"===t.event?(0,o.log)("User clicked not you"):"hidden"===t.event&&(0,o.log)("Send to messenger plugin was hidden")}),(0,o.log)("run callback"),e.callback(e),window.bhAsyncInit&&window.bhAsyncInit()}}(window.BOTHUB),(0,o.loadFacebookSdk)(window.BOTHUB)},function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(3),o=s(i),a=n(5),c=s(a),u=n(6),_=s(u),d=n(0);e.exports=function e(t){r(this,e);var n=t.fb_user_id_key||"fb_user_id",s=(0,d.getFacebookUserId)(n);this.debug=t.debug||!1,this._isins=!0,this.page_id=t.facebook_page_id,this.custom_user_id=(0,d.getCustomUserId)(),this.fb_user_id=s,this.api_server=t.api_server||"https://t.bothub.ai/",this.platforms=t.platforms||["facebook","bothub"],this.callback=t.callback||function(){},this.entrance=t.entrance||{},this.ecommerce=t.ecommerce||{},this.language=t.language||"zh_CN",this.Messenger={origin:location.protocol+"//"+location.host,page_id:t.facebook_page_id,messenger_app_id:t.messenger_app_id||"985673201550272",user_ref:(0,d.getUserRef)(),fb_user_id:s,allow_login:!0},this.ECommerce=new c.default(this),this.Marketing=new o.default(this),this.platforms.indexOf("facebook")>-1?(this.Plugin=new _.default(this),this.Plugin.initMessengerCheckbox(),this.Plugin.initSendToMessenger(),this.Plugin.initMessageUs(),this.Plugin.initCustomerChat()):this.callback(this)}},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=n(0);e.exports=function(){function e(t){s(this,e),this.parent=t}return e.prototype.logEvent=function(e,t,n){if(e){t||(t=null),n instanceof Object||(n={});var s=this.parent.Messenger,i={id:(0,r.getEventId)(),ev:e,params:(0,r.copy)(n)};if(this.parent.entrance.fb_messenger_checkbox_ref&&(i=Object.assign(i,this.parent.entrance.fb_messenger_checkbox_ref)),i.custom_user_id=this.parent.custom_user_id,this.parent.fb_user_id&&(n.fb_user_id=this.parent.fb_user_id,i.fb_user_id=this.parent.fb_user_id),i.user_id||i.fb_user_id||i.custom_user_id){n.user_ref=(0,r.getUserRef)(),n.ref=JSON.stringify(i);var o={app_id:s.messenger_app_id,page_id:s.page_id,user_ref:n.user_ref,ref:n.ref};if(this.parent.platforms.indexOf("facebook")>=0){FB.AppEvents.logEvent("MessengerCheckboxUserConfirmation",null,o);var a=(0,r.copy)(n);delete a.user_ref,delete a.ref,e===r.EventNames.INITIATED_CHECKOUT?(FB.AppEvents.logPurchase(t,n[r.ParameterNames.CURRENCY],a),(0,r.log)("FB.AppEvents.logPurchase",{valueToSum:t,fb_currency:n[r.ParameterNames.CURRENCY],analyticsParams:a})):(FB.AppEvents.logEvent(e,t,a),(0,r.log)("FB.AppEvents.logEvent",{eventName:e,valueToSum:t,analyticsParams:a}))}else if(this.parent.platforms.indexOf("bothub")>=0){delete o.user_ref;var c=(0,r.urlEncode)({cd:o});(0,r.jsonp)(this.parent.api_server+"analytics/events?action=store"+c)}}}},e.prototype.logAddedToCartEvent=function(e,t,n,s){var i={};i[r.ParameterNames.CONTENT_ID]=e,i[r.ParameterNames.CONTENT_TYPE]=t,i[r.ParameterNames.CURRENCY]=n,this.logEvent(r.EventNames.ADDED_TO_CART,s,i)},e.prototype.logAddedToWishlistEvent=function(e,t,n,s){var i={};i[r.ParameterNames.CONTENT_ID]=e,i[r.ParameterNames.CONTENT_TYPE]=t,i[r.ParameterNames.CURRENCY]=n,this.logEvent(r.EventNames.ADDED_TO_WISHLIST,s,i)},e.prototype.logInitiatedCheckoutEvent=function(e,t,n,s,i,o){var a={};a[r.ParameterNames.CONTENT_ID]=e,a[r.ParameterNames.CONTENT_TYPE]=t,a[r.ParameterNames.NUM_ITEMS]=n,a[r.ParameterNames.PAYMENT_INFO_AVAILABLE]=s?1:0,a[r.ParameterNames.CURRENCY]=i,this.logEvent(r.EventNames.INITIATED_CHECKOUT,o,a)},e}()},function(e,t,n){var s,r;!function(i){var o=!1;if(s=i,void 0!==(r="function"==typeof s?s.call(t,n,t,e):s)&&(e.exports=r),o=!0,e.exports=i(),o=!0,!o){var a=window.Cookies,c=window.Cookies=i();c.noConflict=function(){return window.Cookies=a,c}}}(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var s in n)t[s]=n[s]}return t}function t(n){function s(t,r,i){var o;if("undefined"!=typeof document){if(arguments.length>1){if(i=e({path:"/"},s.defaults,i),"number"==typeof i.expires){var a=new Date;a.setMilliseconds(a.getMilliseconds()+864e5*i.expires),i.expires=a}i.expires=i.expires?i.expires.toUTCString():"";try{o=JSON.stringify(r),/^[\{\[]/.test(o)&&(r=o)}catch(e){}r=n.write?n.write(r,t):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)),t=t.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),t=t.replace(/[\(\)]/g,escape);var c="";for(var u in i)i[u]&&(c+="; "+u,!0!==i[u]&&(c+="="+i[u]));return document.cookie=t+"="+r+c}t||(o={});for(var _=document.cookie?document.cookie.split("; "):[],d=/(%[0-9A-Z]{2})+/g,p=0;p<_.length;p++){var f=_[p].split("="),g=f.slice(1).join("=");'"'===g.charAt(0)&&(g=g.slice(1,-1));try{var l=f[0].replace(d,decodeURIComponent);if(g=n.read?n.read(g,l):n(g,l)||g.replace(d,decodeURIComponent),this.json)try{g=JSON.parse(g)}catch(e){}if(t===l){o=g;break}t||(o[l]=g)}catch(e){}}return o}}return s.set=s,s.get=function(e){return s.call(s,e)},s.getJSON=function(){return s.apply({json:!0},[].slice.call(arguments))},s.defaults={},s.remove=function(t,n){s(t,"",e(n,{expires:-1}))},s.withConverter=t,s}return t(function(){})})},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=n(0);e.exports=function(){function e(t){s(this,e),this.parent=t,this.ecommerce=this.parent.ecommerce,this.plugin={messenger_checkbox:{receipt:void 0,receipt_id:void 0,sent:!1},send_to_messenger:{receipt:void 0,receipt_id:void 0,feed:void 0,feed_id:void 0,sent:!1}},Object.assign(this.plugin.messenger_checkbox,this.ecommerce.messenger_checkbox),Object.assign(this.plugin.send_to_messenger,this.ecommerce.send_to_messenger)}return e.prototype.getReceiptId=function(e){return this.plugin[e].receipt_id?this.plugin[e].receipt_id:(this.plugin[e].receipt_id=(0,r.uuid)(),this.plugin[e].receipt_id)},e.prototype.getFeedId=function(e){return this.plugin[e].feed_id?this.plugin[e].feed_id:(this.plugin[e].feed_id=(0,r.uuid)(),this.plugin[e].feed_id)},e.prototype.sendToMessenger=function(e){var t=this.plugin[e],n=this.parent.page_id;if(!t.sent)return t.receipt?(t.receipt={ev:"bh_receipt",receipt_id:t.receipt_id,page_id:n,data:t.receipt},r.Http.post(this.parent.api_server+"tr/",t.receipt),void(t.sent=!0)):void(t.feed&&(t.feed={ev:"bh_feed",feed_id:t.feed_id,page_id:n,data:t.feed},r.Http.post(this.parent.api_server+"tr/",t.feed),t.sent=!0))},e.prototype.resetMessengerCheckboxReceipt=function(e){var t=(0,r.getPlugin)("fb-messenger-checkbox");t&&(t.removeAttribute("fb-iframe-plugin-query"),this.plugin.messenger_checkbox.receipt=e,this.plugin.messenger_checkbox.receipt_id=void 0,BOTHUB.Plugin.initMessengerCheckbox(),window.FB.XFBML.parse(),this.plugin.messenger_checkbox.sent=!1)},e.prototype.resetSendToMessengerReceipt=function(e){var t="bh_receipt"===e.ev?"receipt":"feed",n=(0,r.getPlugin)("fb-send-to-messenger");n&&(n.removeAttribute("fb-iframe-plugin-query"),this.plugin.send_to_messenger[t]=e,this.plugin.send_to_messenger[t+"_id"]=void 0,BOTHUB.Plugin.initSendToMessenger(),window.FB.XFBML.parse(),this.plugin.send_to_messenger.sent=!1)},e.prototype.resetSendToMessengerFeed=function(e){this.plugin.send_to_messenger.receipt=void 0,this.plugin.send_to_messenger.receipt_id=void 0,this.resetSendToMessengerReceipt(e)},e}()},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=n(0);e.exports=function(){function e(t){s(this,e),this.parent=t,this.messenger_checkbox=(0,r.getPlugin)("fb-messenger-checkbox"),this.send_to_messenger=(0,r.getPlugin)("fb-send-to-messenger"),this.messageus=(0,r.getPlugin)("fb-messengermessageus"),this.customerchat=(0,r.getPlugin)("fb-customerchat")}return e.prototype.initMessengerCheckbox=function(){if(this.messenger_checkbox){this.parent.entrance.fb_messenger_checkbox_ref=this.parent.entrance.fb_messenger_checkbox_ref||{},this.parent.ECommerce.plugin.messenger_checkbox.receipt&&Object.assign(this.parent.entrance.fb_messenger_checkbox_ref,{receipt_id:this.parent.ECommerce.getReceiptId("messenger_checkbox")}),this.parent.Messenger.user_ref=(0,r.getUserRef)(!0);for(var e in this.parent.Messenger)this.messenger_checkbox.setAttribute(e,this.parent.Messenger[e])}else this.parent.Messenger.user_ref=(0,r.getUserRef)()},e.prototype.initSendToMessenger=function(){if(this.send_to_messenger){this.send_to_messenger.setAttribute("messenger_app_id",this.parent.Messenger.messenger_app_id),this.send_to_messenger.setAttribute("page_id",this.parent.Messenger.page_id);var e=this.parent.entrance.fb_send_to_messenger_data_ref||{};e.length&&(e=JSON.parse(atob(e.replace("base64:",""))),delete e.receipt_id,delete e.feed_id),this.parent.ECommerce.plugin.send_to_messenger.receipt&&(e.receipt_id=this.parent.ECommerce.getReceiptId("send_to_messenger")),!e.receipt_id&&this.parent.ECommerce.plugin.send_to_messenger.feed&&(e.feed_id=this.parent.ECommerce.getFeedId("send_to_messenger")),e="base64:"+btoa(JSON.stringify(e)),"base64:e30="!==e&&this.send_to_messenger.setAttribute("data-ref",e)}},e.prototype.initMessageUs=function(){this.messageus&&(this.messageus.setAttribute("messenger_app_id",this.parent.Messenger.messenger_app_id),this.messageus.setAttribute("page_id",this.parent.Messenger.page_id))},e.prototype.initCustomerChat=function(){this.customerchat&&(this.customerchat.setAttribute("page_id",this.parent.Messenger.page_id),this.parent.entrance.fb_customerchat_ref&&this.customerchat.setAttribute("ref",this.parent.entrance.fb_customerchat_ref))},e}()}]);